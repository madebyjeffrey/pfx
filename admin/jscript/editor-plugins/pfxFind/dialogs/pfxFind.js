(function(){function E(d){return d.type==CKEDITOR.NODE_TEXT&&d.getLength()>0&&(!p||!d.isReadOnly())}function w(d){return!(d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary(CKEDITOR.tools.extend({},CKEDITOR.dtd.$empty,CKEDITOR.dtd.$nonEditable)))}var p,o=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}},x=["pfxFind","pfxReplace"],q=[["txtFindFind","txtFindReplace"],["txtFindCaseChk",
"txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]],D=function(d,y){function z(a,b){var c=new CKEDITOR.dom.range;c.setStart(a.textNode,b?a.offset:a.offset+1);c.setEndAt(d.document.getBody(),CKEDITOR.POSITION_BEFORE_END);return c}function r(a){var b=d.getSelection(),c=d.document.getBody();if(b&&!a){a=b.getRanges()[0].clone();a.collapse(true)}else{a=new CKEDITOR.dom.range;a.setStartAt(c,CKEDITOR.POSITION_AFTER_START)}a.setEndAt(c,CKEDITOR.POSITION_BEFORE_END);
return a}var A=new CKEDITOR.style(CKEDITOR.tools.extend({fullMatch:true,childRule:function(){return 0}},d.config.find_highlight)),n=function(a,b){var c=this,f=new CKEDITOR.dom.walker(a);f.guard=b?w:function(g){!w(g)&&(c._.matchBoundary=true)};f.evaluator=E;f.breakOnFalse=1;if(a.startContainer.type==CKEDITOR.NODE_TEXT){this.textNode=a.startContainer;this.offset=a.startOffset-1}this._={matchWord:b,walker:f,matchBoundary:false}};n.prototype={next:function(){return this.move()},back:function(){return this.move(true)},
move:function(a){var b=this.textNode;if(b===null)return o.call(this);this._.matchBoundary=false;if(b&&a&&this.offset>0){this.offset--;return o.call(this)}else if(b&&this.offset<b.getLength()-1){this.offset++;return o.call(this)}else{for(b=null;!b;){b=this._.walker[a?"previous":"next"].call(this._.walker);if(this._.matchWord&&!b||this._.walker._.end)break}this.offset=(this.textNode=b)?a?b.getLength()-1:0:0}return o.call(this)}};var s=function(a,b){this._={walker:a,cursors:[],rangeLength:b,highlightRange:null,
isMatched:0}};s.prototype={toDomRange:function(){var a=new CKEDITOR.dom.range(d.document),b=this._.cursors;if(b.length<1){var c=this._.walker.textNode;if(c)a.setStartAfter(c);else return null}else{c=b[0];b=b[b.length-1];a.setStart(c.textNode,c.offset);a.setEnd(b.textNode,b.offset+1)}return a},updateFromDomRange:function(a){var b=new n(a);this._.cursors=[];do{a=b.next();a.character&&this._.cursors.push(a)}while(a.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=
true},clearMatched:function(){this._.isMatched=false},isMatched:function(){return this._.isMatched},highlight:function(){if(!(this._.cursors.length<1)){this._.highlightRange&&this.removeHighlight();var a=this.toDomRange(),b=a.createBookmark();A.applyToRange(a);a.moveToBookmark(b);this._.highlightRange=a;b=a.startContainer;if(b.type!=CKEDITOR.NODE_ELEMENT)b=b.getParent();b.scrollIntoView();this.updateFromDomRange(a)}},removeHighlight:function(){if(this._.highlightRange){var a=this._.highlightRange.createBookmark();
A.removeFromRange(this._.highlightRange);this._.highlightRange.moveToBookmark(a);this.updateFromDomRange(this._.highlightRange);this._.highlightRange=null}},isReadOnly:function(){if(!this._.highlightRange)return 0;return this._.highlightRange.startContainer.isReadOnly()},moveBack:function(){var a=this._.walker.back(),b=this._.cursors;if(a.hitMatchBoundary)this._.cursors=b=[];b.unshift(a);b.length>this._.rangeLength&&b.pop();return a},moveNext:function(){var a=this._.walker.next(),b=this._.cursors;
if(a.hitMatchBoundary)this._.cursors=b=[];b.push(a);b.length>this._.rangeLength&&b.shift();return a},getEndCharacter:function(){var a=this._.cursors;if(a.length<1)return null;return a[a.length-1].character},getNextCharacterRange:function(a){var b,c;c=this._.cursors;c=(b=c[c.length-1])&&b.textNode?new n(z(b)):this._.walker;return new s(c,a)},getCursors:function(){return this._.cursors}};var B=function(a,b){var c=[-1];if(b)a=a.toLowerCase();for(var f=0;f<a.length;f++)for(c.push(c[f]+1);c[f+1]>0&&a.charAt(f)!=
a.charAt(c[f+1]-1);)c[f+1]=c[c[f+1]-1]+1;this._={overlap:c,state:0,ignoreCase:!!b,pattern:a}};B.prototype={feedCharacter:function(a){if(this._.ignoreCase)a=a.toLowerCase();for(;;)if(a==this._.pattern.charAt(this._.state)){this._.state++;if(this._.state==this._.pattern.length){this._.state=0;return 2}return 1}else if(this._.state)this._.state=this._.overlap[this._.state];else return 0;return null},reset:function(){this._.state=0}};var F=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,
C=function(a){if(!a)return true;var b=a.charCodeAt(0);return b>=9&&b<=13||b>=8192&&b<=8202||F.test(a)},h={searchRange:null,matchRange:null,find:function(a,b,c,f,g,k){if(this.matchRange){this.matchRange.removeHighlight();this.matchRange=this.matchRange.getNextCharacterRange(a.length)}else this.matchRange=new s(new n(this.searchRange),a.length);for(var i=new B(a,!b),j=0,l="%";l!==null;){for(this.matchRange.moveNext();l=this.matchRange.getEndCharacter();){j=i.feedCharacter(l);if(j==2)break;this.matchRange.moveNext().hitMatchBoundary&&
i.reset()}if(j==2){if(c){var m=this.matchRange.getCursors(),t=m[m.length-1],u=n;m=m[0];var v=new CKEDITOR.dom.range;v.setStartAt(d.document.getBody(),CKEDITOR.POSITION_AFTER_START);v.setEnd(m.textNode,m.offset);u=new u(v,true);t=new n(z(t),true);if(!(C(u.back().character)&&C(t.next().character)))continue}this.matchRange.setMatched();g!==false&&this.matchRange.highlight();return true}}this.matchRange.clearMatched();this.matchRange.removeHighlight();if(f&&!k){this.searchRange=r(1);this.matchRange=null;
return arguments.callee.apply(this,Array.prototype.slice.call(arguments).concat([true]))}return false},replaceCounter:0,replace:function(a,b,c,f,g,k,i){p=1;a=0;if(this.matchRange&&this.matchRange.isMatched()&&!this.matchRange._.isReplaced&&!this.matchRange.isReadOnly()){this.matchRange.removeHighlight();b=this.matchRange.toDomRange();c=d.document.createText(c);if(!i){var j=d.getSelection();j.selectRanges([b]);d.fire("saveSnapshot")}b.deleteContents();b.insertNode(c);if(!i){j.selectRanges([b]);d.fire("saveSnapshot")}this.matchRange.updateFromDomRange(b);
i||this.matchRange.highlight();this.matchRange._.isReplaced=true;this.replaceCounter++;a=1}else a=this.find(b,f,g,k,!i);p=0;return a}},e=d.lang.findAndReplace;return{title:e.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:165,buttons:[CKEDITOR.dialog.cancelButton],contents:[{id:"pfxFind",label:e.find,title:e.find,accessKey:"",elements:[{type:"hbox",widths:["230px"],children:[{type:"text",id:"txtFindFind",label:e.findWhat,isChanged:false,labelLayout:"horizontal",accessKey:"F"}]},
{type:"hbox",children:[{type:"button",align:"left",style:"width:100%",label:e.find,onClick:function(){var a=this.getDialog();h.find(a.getValueOf("pfxFind","txtFindFind"),a.getValueOf("pfxFind","txtFindCaseChk"),a.getValueOf("pfxFind","txtFindWordChk"),a.getValueOf("pfxFind","txtFindCyclic"))||alert(e.notFoundMsg)}}]},{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:false,style:"margin-top:28px",label:e.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:false,
label:e.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:false,"default":true,label:e.matchCyclic}]}]},{id:"pfxReplace",label:e.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px"],children:[{type:"text",id:"txtFindReplace",label:e.findWhat,isChanged:false,labelLayout:"horizontal",accessKey:"F"}]},{type:"hbox",children:[{type:"button",align:"left",style:"width:100%",label:e.replace,onClick:function(){var a=this.getDialog();h.replace(a,a.getValueOf("pfxReplace","txtFindReplace"),a.getValueOf("pfxReplace",
"txtReplace"),a.getValueOf("pfxReplace","txtReplaceCaseChk"),a.getValueOf("pfxReplace","txtReplaceWordChk"),a.getValueOf("pfxReplace","txtReplaceCyclic"))||alert(e.notFoundMsg)}}]},{type:"hbox",widths:["230px"],children:[{type:"text",id:"txtReplace",label:e.replaceWith,isChanged:false,labelLayout:"horizontal",accessKey:"R"}]},{type:"hbox",children:[{type:"button",align:"left",style:"width:100%",label:e.replaceAll,isChanged:false,onClick:function(){var a=this.getDialog();h.replaceCounter=0;h.searchRange=
r(1);if(h.matchRange){h.matchRange.removeHighlight();h.matchRange=null}for(d.fire("saveSnapshot");h.replace(a,a.getValueOf("pfxReplace","txtFindReplace"),a.getValueOf("pfxReplace","txtReplace"),a.getValueOf("pfxReplace","txtReplaceCaseChk"),a.getValueOf("pfxReplace","txtReplaceWordChk"),false,true););if(h.replaceCounter){alert(e.replaceSuccessMsg.replace(/%1/,h.replaceCounter));d.fire("saveSnapshot")}else alert(e.notFoundMsg)}}]},{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",
isChanged:false,label:e.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:false,label:e.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:false,"default":true,label:e.matchCyclic}]}]}],onLoad:function(){var a=this,b,c=0;this.on("hide",function(){c=0});this.on("show",function(){c=1});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(f){return function(g){f.call(a,g);var k=a._.tabs[g],i,j;i=g==="pfxFind"?"txtFindFind":"txtFindReplace";j=g==="pfxFind"?"txtFindWordChk":
"txtReplaceWordChk";b=a.getContentElement(g,i);a.getContentElement(g,j);if(!k.initialized){CKEDITOR.document.getById(b._.inputId);k.initialized=true}if(c){g=g==="pfxFind"?1:0;k=1-g;var l,m=q.length;for(l=0;l<m;l++){i=this.getContentElement(x[g],q[l][g]);j=this.getContentElement(x[k],q[l][k]);j.setValue(i.getValue())}}}})},onShow:function(){h.searchRange=r();this.selectPage(y)},onHide:function(){var a;if(h.matchRange&&h.matchRange.isMatched()){h.matchRange.removeHighlight();d.focus();(a=h.matchRange.toDomRange())&&
d.getSelection().selectRanges([a])}delete h.matchRange},onFocus:function(){return y=="pfxReplace"?this.getContentElement("pfxReplace","txtFindReplace"):this.getContentElement("pfxFind","txtFindFind")}}};CKEDITOR.dialog.add("pfxFind",function(d){return D(d,"pfxFind")});CKEDITOR.dialog.add("pfxReplace",function(d){return D(d,"pfxReplace")})})();