CKEDITOR.plugins.add("pfxLink",{init:function(b){b.addCommand("pfxLink",new CKEDITOR.dialogCommand("pfxLink"));b.addCommand("anchor",new CKEDITOR.dialogCommand("anchor"));b.addCommand("unlink",new CKEDITOR.unlinkCommand);b.ui.addButton("pfxLink",{label:b.lang.link.toolbar,command:"pfxLink"});b.ui.addButton("Unlink",{label:b.lang.unlink,command:"unlink"});b.ui.addButton("Anchor",{label:b.lang.anchor.toolbar,command:"anchor"});CKEDITOR.dialog.add("pfxLink",this.path+"dialogs/pfxLink.js");CKEDITOR.dialog.add("anchor",
this.path+"dialogs/anchor.js");b.addCss("img.cke_anchor{background-image: url("+CKEDITOR.getUrl(this.path+"images/anchor.gif")+");background-position: center center;background-repeat: no-repeat;border: 1px solid #a9a9a9;width: 18px !important;height: 18px !important;}\na.cke_anchor{background-image: url("+CKEDITOR.getUrl(this.path+"images/anchor.gif")+");background-position: 0 center;background-repeat: no-repeat;border: 1px solid #a9a9a9;padding-left: 18px;}");b.on("selectionChange",function(a){var c=
b.getCommand("unlink");(a=a.data.path.lastElement&&a.data.path.lastElement.getAscendant("a",true))&&a.getName()=="a"&&a.getAttribute("href")?c.setState(CKEDITOR.TRISTATE_OFF):c.setState(CKEDITOR.TRISTATE_DISABLED)});b.on("doubleclick",function(a){var c=CKEDITOR.plugins.link.getSelectedLink(b)||a.data.element;if(c.is("a"))a.data.dialog=c.getAttribute("name")&&!c.getAttribute("href")?"anchor":"pfxLink";else if(c.is("img")&&c.getAttribute("_cke_real_element_type")=="anchor")a.data.dialog="anchor"});
b.addMenuItems&&b.addMenuItems({anchor:{label:b.lang.anchor.menu,command:"anchor",group:"anchor"},link:{label:b.lang.link.menu,command:"pfxLink",group:"pfxLink",order:1},unlink:{label:b.lang.unlink,command:"unlink",group:"pfxLink",order:5}});b.contextMenu&&b.contextMenu.addListener(function(a){if(!a||a.isReadOnly())return null;a=a.is("img")&&a.getAttribute("_cke_real_element_type")=="anchor";if(!a){if(!(a=CKEDITOR.plugins.link.getSelectedLink(b)))return null;a=a.getAttribute("name")&&!a.getAttribute("href")}return a?
{anchor:CKEDITOR.TRISTATE_OFF}:{link:CKEDITOR.TRISTATE_OFF,unlink:CKEDITOR.TRISTATE_OFF}})},afterInit:function(b){var a=b.dataProcessor;(a=a&&a.dataFilter)&&a.addRules({elements:{a:function(c){var d=c.attributes;if(d.name&&!d.href)return b.createFakeParserElement(c,"cke_anchor","anchor")}}})},requires:["fakeobjects"]});
CKEDITOR.plugins.link={getSelectedLink:function(b){try{var a=b.getSelection();if(a.getType()==CKEDITOR.SELECTION_ELEMENT){var c=a.getSelectedElement();if(c.is("a"))return c}var d=a.getRanges(true)[0];d.shrink(CKEDITOR.SHRINK_TEXT);return d.getCommonAncestor().getAscendant("a",true)}catch(e){return null}}};CKEDITOR.unlinkCommand=function(){};
CKEDITOR.unlinkCommand.prototype={exec:function(b){for(var a=b.getSelection(),c=a.createBookmarks(),d=a.getRanges(),e,f=0;f<d.length;f++){e=d[f].getCommonAncestor(true);(e=e.getAscendant("a",true))&&d[f].selectNodeContents(e)}a.selectRanges(d);b.document.$.execCommand("unlink",false,null);a.selectBookmarks(c)},startDisabled:true};CKEDITOR.tools.extend(CKEDITOR.config,{linkShowAdvancedTab:true,linkShowTargetTab:true});